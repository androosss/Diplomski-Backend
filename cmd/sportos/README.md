TRI Pay
=========================

## About 

A service that provides payment routing of depositing or withdrawing actions. 

 
## Main functionalities

* Communication with different payment providers
* Communication with PAM internal service
* Order Polling: a proces where checking for order processing is done in timed intervals
* Web hooks for payment providers

## Swagger

https://goswagger.io/ is used. In order to generate swagger.json follow the instructions for swagger installation (download exe from https://github.com/go-swagger/go-swagger/releases/tag/v0.28.0 and put in your go/bin folder which should be in your path) and then make a call: `.\internal\scripts\swagger.generate.sh` from inside the `cmd\sportos` folder

When writing swagger comments, if any comments are needed in code they should be before [swagger] comment. Swagger comment should have a comment line with  [swagger] and then empty uncommented line and then swagger comment. Swagger comment should start with title, then empty commented line, then description and finish with line // swagger:model <DefinitionName>. Example:

// PPMethod
// Available Payment methods, PaymentMethodName in DB must be equal to constant

// [swagger]

// PaymentMethodTitle
//
// TRI Pay available methods
//    * `PAYPAL` - PayPal
//    * `DUMMY` - Simple dummy payment provider for testing purposes
// swagger:model PaymentMethodDefinitionName
type PPMethod string

As shown in the example, first part of comment with PPMethod and PaymentMethodName mention will not be in swagger.
If you have multiple struct named same in different packages, and want to differentiate you can add different swagger definition name after swagger:model like in the example.

## Authentication

JWT Bearer Token is used for authentication. Token generated by PAM is used.

## How to test

In order to run the backend TRI Pay database with test data use: `backend\cmd\sportos\internal\test\Dockerfile`

If migration_base is used, database will be empty. DML test data file is located here: `backend\cmd\sportos\internal\test\V1.01__DML_TEST.sql`

Launch paramaters for localhost database can be seen here: `backend\.vscode\launch.json` as `sportos.docker`. Complete description of parameters: `backend\cmd\sportos\internal\docs.go`
